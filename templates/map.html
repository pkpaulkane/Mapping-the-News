<html>
  <head><title>Mapping the News</title></head>
  <h1>Mapping the News</h1>
  <head>
    <style>
    ul {
        width: 100%;
        list-style-type: none;
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #333;
    }
    
    li {
        float: left;
        border-right:1px solid #bbb;
    }
    
    li:last-child {
        border-right: none;
    }
    
    li a {
        display: block;
        color: white;
        text-align: center;
        padding: 14px 16px;
        text-decoration: none;
    }
    
    li a:hover:not(.active) {
        background-color: #B5D3E7;
    }
    
    .active {
        background-color: #89cff0;
    }
    </style>
    </head>
    <body>
    
    <ul>
      <li><a class = "articles" href="{{ url_for('articles') }}">Articles</a></li>
      <li><a class="active" href="{{ url_for('map') }}">Map</a></li>
      <li><a class = "entertainment" href = "{{ url_for('entertainment') }}">Entertainment</a></li>
      <li><a class = "business" href = "{{ url_for('business') }}">Business</a></li>
      <li><a class = "politics" href = "{{ url_for('politics') }}">Politics</a></li>
      
    </ul>
    
    </body>
  <body>
  <div id="mapdiv" style="float: left; width: 100%; height: 100%; ">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/openlayers/2.11/lib/OpenLayers.js"></script> 
  <script>

    
    map = new OpenLayers.Map("mapdiv");
    map.addLayer(new OpenLayers.Layer.OSM());
    
    epsg4326 =  new OpenLayers.Projection("EPSG:4326"); //WGS 1984 projection
    projectTo = map.getProjectionObject(); //The map projection (Spherical Mercator)
   
    var lonLat = new OpenLayers.LonLat( -0.21279688 ,21.5077286 ).transform(epsg4326, projectTo);
          
    var zoom=4;
    map.setCenter (lonLat, zoom);

    var vectorLayer = new OpenLayers.Layer.Vector("Overlay");
    
    var lat = [];
    var lon = []; 
    var url = [];
    var place = [];

    {% for latitude in lat %}
      coordinateLat = {{ latitude | safe }}
      lat.push(coordinateLat)    
    {% endfor %}

    {% for longitude in lon %}
      coordinateLong = {{ longitude | safe }}
      lon.push(coordinateLong)    
    {% endfor %}

    {% for site in url %}
        coordSite = '{{ site }}'
        url.push(coordSite)    
    {% endfor %}

    {% for name in place %}
        coordPlace = '{{ name | safe }}'   
        place.push(coordPlace)    
    {% endfor %}
   
    var url2 = "https://en.wikipedia.org/wiki/Nelson's_Column";
  
    //alert(lat[0])
    //alert(lon[0])
    //alert(site[0])
    //alert(place[0])

    //Loop through the markers array
    for (var i=0; i<lat.length; i++) {
    
        var feature = new OpenLayers.Feature.Vector(
            new OpenLayers.Geometry.Point( lat[i], lon[i] ).transform(epsg4326, projectTo),
            {description: '<a href="' + url[i] + '">' + place[i] + '</a>'},
            {externalGraphic: href = 'https://gkv.com/wp-content/uploads/leaflet-maps-marker-icons/map_marker-red.png', graphicHeight: 50, graphicWidth: 40, graphicXOffset:-12, graphicYOffset:-25  }
        ); 
 

        //feature.bindPopup(url[i]);
      vectorLayer.addFeatures(feature);

    }                        
    
    map.addLayer(vectorLayer);

        //Add a selector control to the vectorLayer with popup functions
        var controls = {
      selector: new OpenLayers.Control.SelectFeature(vectorLayer, { onSelect: createPopup, onUnselect: destroyPopup })
    };

    function createPopup(feature) {
      feature.popup = new OpenLayers.Popup.FramedCloud("pop",
          feature.geometry.getBounds().getCenterLonLat(),
          null,
          '<div class="markerContent">'+feature.attributes.description+'</div>',
          null,
          true,
          function() { controls['selector'].unselectAll(); }
      );
      //feature.popup.closeOnMove = true;
      map.addPopup(feature.popup);
    }

    function destroyPopup(feature) {
      feature.popup.destroy();
      feature.popup = null;
    }
    
    map.addControl(controls['selector']);
    controls['selector'].activate();
  </script>
  </div>
</body>
</html>
    